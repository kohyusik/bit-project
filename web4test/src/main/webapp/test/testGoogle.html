<html>
<head>
  <title>Demo: Getting an email address using the Google+ Sign-in button</title>
  <style type="text/css">
  .hide { display: none;}
  .show { display: block;}
  </style>
  <script src="https://apis.google.com/js/plusone.js" type="text/javascript"></script>
  <script type="text/javascript">
  /*
   * 로그인을 승인하거나, 취소하거나, 승인 대화상자를
   * 닫으면 실행됩니다.
   */
  function loginFinishedCallback(authResult) {
    if (authResult) {
      if (authResult['error'] == undefined){
        gapi.auth.setToken(authResult); // 반환된 토큰을 저장합니다.
        toggleElement('signin-button'); // 로그인에 성공하면 로그인을 숨깁니다.
        getEmail();                     // 이메일 주소 가져오기 요청을 실행합니다.
      } else {
        console.log('An error occurred');
      }
    } else {
      console.log('Empty authResult');  // 문제 발생
    }
  }

  /*
   * userinfo 끝점에 대한 요청을 실행하여 사용자의 이메일
   * 주소를 가져옵니다. 이 함수에는 유효한 OAuth 액세스 토큰이 포함된 gapi.auth.setToken이
   *  필요합니다.
   *
   * 요청이 완료되면 getEmailCallback이 실행되고 요청의 결과가
   * 전달됩니다.
   */
  function getEmail(){
    // userinfo 메소드를 사용할 수 있도록 oauth2 라이브러리를 로드합니다.
/*     gapi.client.load('oauth2', 'v2', function() {
          var request = gapi.client.oauth2.userinfo.get();
          request.execute(getEmailCallback);
        }); */
  }

  function getEmailCallback(obj){
    var el = document.getElementById('email');
    var email = '';

    if (obj['email']) {
      email = 'Email: ' + obj['email'];
    }

    console.log(obj);   // 전체 개체를 검사하려면 주석을 해제합니다.

    el.innerHTML = email;
    toggleElement('email');
  }

  function toggleElement(id) {
    var el = document.getElementById(id);
    if (el.getAttribute('class') == 'hide') {
      el.setAttribute('class', 'show');
    } else {
      el.setAttribute('class', 'hide');
    }
  }
  </script>
</head>
<body>
  <div id="signin-button" class="show">
     <div class="g-signin" data-callback="loginFinishedCallback"
      data-approvalprompt="force"
      data-clientid="3679365711-ilsb14e01shkrnbn2mag9jurhn9lsjnj.apps.googleusercontent.com"
      data-scope="https://www.googleapis.com/auth/plus.login
                  https://www.googleapis.com/auth/userinfo.email"
      data-height="short"
      data-cookiepolicy="single_host_origin"
      >
    </div>
  </div>

  <div id="email" class="hide"></div>
</body>
</html>